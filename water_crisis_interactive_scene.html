<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<script src="https://d3js.org/d3.v5.min.js"></script>

<style type="text/css">

body {
	font: 14px sans-serif;
}

.line {
    fill: none;
    stroke: steelblue;
    stroke-width: 3;
}


.line2 {
    fill: none;
    stroke: orange;
    stroke-width: 3;
}

.line3 {
    fill: none;
    stroke: grey;
    stroke-width: 3;
}

.line4 {
    fill: none;
    stroke: green;
    stroke-width: 3;
}


.axis--x text {
  font: 10px sans-serif;
}

.axis--y text {
  font: 10px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

#yyyy{
	position:absolute;
	left:50px;
	width:75px;
	height: 30px;
	background-color: lightblue
}

#next{
	position:absolute;
	top:520px;
	left:900px;

}
#prev{
	position:absolute;
	top:520px;
	left:40px;
}

</style>
<Title> Water Crisis in Chennai</Title>
</head>
<body onload='init()'>
  <H1> Water Crisis in Chennai</H1>
  <p> It is clear from the previous two graphs that current reservoir system is not working and
		situation has reached to crisis level. Though the state of Karnataka has been helping the help has been varying. Here is the chart
		where you can analyze how yearly different reservoirs has performed with respect to rainfall.
		On little analysis you will find that the help received is <b style="color:red"> not enough!</b>
		Government must find other ways of dealing	with this crisis. Few of the things can be done are:
		<ul>
 			<li>Rainwater harvesting in residential buildings</li>
 			<li>Spreading more awareness regarding the ways of saving water</li>
 			<li>Getting more river water released from State of Karnataka</li>
		</ul>
		</p>
		<select id="yyyy" onchange="populateData()">
		<option value="2018" selected="selected">2018</option>
		<option value="2017" color =  white>2017</option>
		<option value="2016">2016</option>
		<option value="2015">2015</option>
		<option value="2014">2014</option>
		<option value="2013">2013</option>
		<option value="2012">2012</option>
		<option value="2011">2011</option>
		<option value="2010">2010</option>
		<option value="2009">2009</option>
		<option value="2008">2008</option>
		</select>
		<br>
		<br>
		<div id="next">
	<input name="next"
	 type="button"
	 disabled = True
	 value="Next"
	 onclick="showAll()" />
</div>
<div id="prev">
	<input name="prev"
	 type="button"
	 value="Prev"
	 onclick="window.location.href = 'https://rohitbansal83.github.io/DVHW07/water_crisis_chennai.html';" />
</div>
<script type="text/javascript">
var gdata;
var colors = ["steelblue", "orange", "grey", "green"];
var area = ["Poondi",  "Redhills", "Chembarambakkam", "Cholavaram",];
var margin = {top: 20, right: 50, bottom: 50, left: 100},
    width = 960 - margin.left - margin.right;
    height = 300 - margin.top - margin.bottom;

var y1 = d3.scaleLinear().domain([0,2000]).range([height,0]);
var y2 = d3.scaleLinear().domain([0,2600]).range([height,0]);
var x1 = d3.scaleBand()
					.domain(["Poondi",  "Redhills", "Chembarambakkam", "Cholavaram"])
					.range([0,(width/2)-10])
					.paddingInner(0.3)
					.paddingOuter(0.2);
var x2pos = margin.left+(width/2)+10;

var bar1;
var bar2;
async function init() {
const data = await d3.csv('https://rohitbansal83.github.io/DVHW07/chennai_watercrisis_10_years.csv');

console.log(data);
gdata = data;
console.log(gdata);

//var x2 = d3.scaleBand().domain(["Poondi", "Cholavaram", "Redhills", "Chembarambakkam"]).range([(width/2)+10, width]);

var svg = d3.select("body").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom);


var t = height + margin.top;

var txw = (width/4) ;
var txh = margin.top ;

var tyh = margin.top;
var tyw = (3*width/4);


var lx = width + margin.left+margin.right;
var ly = margin.top;

var legend = svg.append('g')
                .attr("transform", "translate("+ lx +","+ ly+ ")");




d3.select('svg').append('g')
  .attr("class", "axis axis--y")
  .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
  .call(d3.axisLeft(y1)
  .tickValues([0,200,400,600,800,1000,1200,1400,1600,1800,2000]).tickFormat(d3.format('0')));


d3.select('svg').append('g')
  .attr("class", "axis axis--x")
  .attr("transform", "translate(" + margin.left + "," + t + ")")
  .call(d3.axisBottom(x1)
  .tickValues(area));


	d3.select('svg').append('g')
	  .attr("class", "axis axis--y")
	  .attr("transform", "translate(" + x2pos + "," + margin.top + ")")
	  .call(d3.axisLeft(y2)
	  .tickValues([0,200,400,600,800,1000,1200,1400,1600,1800,2000,2200,2400,2600]).tickFormat(d3.format('0')));

	d3.select('svg').append('g')
	  .attr("class", "axis axis--x")
	  .attr("transform", "translate(" + x2pos + "," + t + ")")
	  .call(d3.axisBottom(x1)
	  .tickValues(area));


svg.append("text")
    .attr("x", txw )
    .attr("y", txh )
    .style("font-family", "sans-serif")
    .style("font-size", 20)
    .style("font-weight","bold")
    .text("Rainfall");

svg.append("text")
        .attr("x", tyw )
        .attr("y", tyh )
        .style("font-family", "sans-serif")
        .style("font-size", 20)
        .style("font-weight","bold")
        .text("Reservoir Water Level");




	/*d3.select('svg').append('g')
				  .attr("transform", "translate(" + margin.left + "," + t + ")")
					.selectAll('rect')
					.data(data)
					.enter()
					.append('rect')
						.attr('x',function(d,i){return x1(area[i]);})
						.attr('y',function(d){return y1(d.rf2018);})
						.attr('width', 25)
						.attr('height', function(d) {return t-y1(d.rf2018);})
						.attr("fill",function(d,i){return colors[i];});*/
			bar1 = d3.select('svg').append('g')
							.attr("transform", "translate(" + margin.left + "," + margin.top + ")")
							.selectAll('rect')
							.data(data)
							.enter()
							.append('rect')
								.attr('x',function(d,i){return x1(area[i])+25;})
								.attr('y',function(d){return  y1(parseInt(d.rf2018));})
								.attr('width', 25)
								.attr('height', function(d){return height-y1(parseInt(d.rf2018));})
								.attr("fill",function(d,i){return colors[i];});

			bar2 = d3.select('svg').append('g')
							.attr("transform", "translate(" + x2pos + "," + margin.top + ")")
							.selectAll('rect')
							.data(data)
							.enter()
							.append('rect')
								.attr('x',function(d,i){return x1(area[i])+25;})
								.attr('y',function(d){ return  y2(parseInt(d.rl2018));})
								.attr('width', 25)
								.attr('height', function(d){return height-y2(parseInt(d.rl2018));})
								.attr("fill",function(d,i){return colors[i];});

						area.forEach(function(area, i) {
							var legendRow = legend.append("g")
																		.attr("transform", "translate(-10," + (i*20) + ")");
							legendRow.append("rect")
							.attr("width",10)
							.attr("height",10)
							.attr("fill",colors[i]);

							legendRow.append("text")
							.attr("x",-10)
							.attr("y",10)
							.attr("text-anchor","end")
							.text(area);
						});


/*
svg.append("path")
    .datum(data)
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
    .attr("class", "line")
    .attr("d", line)
    .attr("data-legend","test");

svg.append("path")
    .datum(data)
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
    .attr("class", "line2")
    .attr("d", line2);

svg.append("path")
    .datum(data)
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
    .attr("class", "line3")
    .attr("d", line3);

svg.append("path")
    .datum(data)
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
    .attr("class", "line4")
    .attr("d", line4);


dots.enter().append("circle")
        .attr("class", "dot")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
        .attr("cx", function(d, i) {  return x(parseInt(d.Year)); })
        .attr("cy", function(d) { return y(parseInt(d.CHEMBARAMBAKKAM)); })
        .attr("r", 3);

dots.enter().append("circle")
      .attr("class", "dot")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
      .attr("cx", function(d, i) {  return x(parseInt(d.Year)); })
      .attr("cy", function(d) { return y(parseInt(d.REDHILLS)); })
      .attr("r", 3);

dots.enter().append("circle")
      .attr("class", "dot")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
      .attr("cx", function(d, i) {  return x(parseInt(d.Year)); })
      .attr("cy", function(d) { return y(parseInt(d.CHOLAVARAM)); })
      .attr("r", 3);

dots.enter().append("circle")
      .attr("class", "dot")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
      .attr("cx", function(d, i) {  return x(parseInt(d.Year)); })
      .attr("cy", function(d) { return y(parseInt(d.POONDI)); })
      .attr("r", 3);

*/


}

function populateData() {
  var local_x = document.getElementById("yyyy").value;
	var local_rf = "rf"+local_x;
	var local_rl = "rl"+local_x;
	console.log(local_x);

	bar1.style('display', 'none');
	bar2.style('display', 'none');


	bar1 = d3.select('svg').append('g')
					.attr("transform", "translate(" + margin.left + "," + margin.top + ")")
					.selectAll('rect')
					.data(gdata).enter()
					.append('rect')
						.attr('x',function(d,i){return x1(area[i])+25;})
						.attr('y',function(d){return  y1(parseInt(d[local_rf]));})
						.attr('width', 25)
						.attr('height', function(d){return height-y1(parseInt(d[local_rf]));})
						.attr("fill",function(d,i){return colors[i];});

	bar2 = d3.select('svg').append('g')
					.attr("transform", "translate(" + x2pos + "," + margin.top + ")")
					.selectAll('rect')
					.data(gdata).enter()
					.append('rect')
						.attr('x',function(d,i){return x1(area[i])+25;})
						.attr('y',function(d){ return  y2(parseInt(d[local_rl]));})
						.attr('width', 25)
						.attr('height', function(d){return height-y2(parseInt(d[local_rl]));})
						.attr("fill",function(d,i){return colors[i];});

}

</script>
</body>
</html>
